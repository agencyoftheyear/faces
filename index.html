<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relat√≥rio Financeiro Estrat√©gico ‚Äî Cl√≠nica FACES</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg-color: #f4f7f6;
            --card-bg: #ffffff;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --accent-blue: #0f172a;
            --accent-green: #10b981;
            --accent-red: #ef4444;
            --accent-yellow: #f59e0b;
            --brand-font: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--brand-font);
            background-color: var(--bg-color);
            color: var(--text-primary);
            line-height: 1.6;
            padding-bottom: 50px;
        }

        /* --- LOGIN SCREEN --- */
        #login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--accent-blue);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }

        .login-card {
            background: white;
            padding: 3rem;
            border-radius: 16px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            text-align: center;
            width: 100%;
            max-width: 420px;
        }

        .login-logo {
            font-size: 2rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
            letter-spacing: -1px;
            color: var(--accent-blue);
        }

        .login-subtitle {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 2.5rem;
        }

        .login-input {
            width: 100%;
            padding: 14px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            margin-bottom: 1.5rem;
            transition: border-color 0.2s;
            outline: none;
            text-align: center;
            letter-spacing: 2px;
        }

        .login-input:focus {
            border-color: var(--accent-blue);
        }

        .login-btn {
            width: 100%;
            padding: 14px;
            background-color: var(--accent-blue);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .login-btn:hover {
            background-color: #1e293b;
        }

        .error-msg {
            color: var(--accent-red);
            font-size: 0.85rem;
            margin-top: 1rem;
            min-height: 1.2em;
            opacity: 0;
            transition: opacity 0.2s;
            font-weight: 600;
        }

        /* --- HEADER & BADGE --- */
        header {
            background: var(--accent-blue);
            color: white;
            padding: 3rem 2rem;
            position: relative;
            overflow: hidden;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            z-index: 2;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            letter-spacing: -0.05em;
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.8;
            font-weight: 300;
        }

        .agency-badge {
            position: absolute;
            top: 2rem;
            right: 2rem;
            background-color: #ef4444;
            color: white;
            padding: 10px;
            font-size: 0.6rem;
            font-weight: 800;
            text-transform: uppercase;
            line-height: 1.2;
            letter-spacing: 1px;
            z-index: 10;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            text-align: right;
        }

        /* --- LAYOUT GRID --- */
        /* Oculto inicialmente at√© login */
        #dashboard-content {
            display: none;
            opacity: 0;
            transition: opacity 0.8s ease;
        }

        .container {
            max-width: 1200px;
            margin: -2rem auto 0;
            padding: 0 1rem;
            position: relative;
            z-index: 5;
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 1.5rem;
        }

        .card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: transform 0.2s ease;
        }

        .card:hover {
            transform: translateY(-2px);
        }

        .card-title {
            font-size: 0.9rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 600;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        /* --- KPI CARDS --- */
        .col-3 { grid-column: span 3; }
        .col-4 { grid-column: span 4; }
        .col-6 { grid-column: span 6; }
        .col-8 { grid-column: span 8; }
        .col-12 { grid-column: span 12; }

        @media (max-width: 768px) {
            .col-3, .col-4, .col-6, .col-8 { grid-column: span 12; }
            h1 { font-size: 1.8rem; }
            .agency-badge { display: none; }
        }

        .kpi-value {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--accent-blue);
        }

        .kpi-sub {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }

        .text-green { color: var(--accent-green); }
        .text-red { color: var(--accent-red); }

        /* --- INSIGHT BOX --- */
        .insight-box {
            background-color: #f8fafc;
            border-left: 4px solid var(--accent-blue);
            padding: 1rem;
            margin-top: 1rem;
            font-size: 0.9rem;
            color: var(--text-secondary);
            font-style: italic;
        }

        .alert-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: bold;
            background: #fee2e2;
            color: #ef4444;
            margin-bottom: 0.5rem;
        }

        /* --- TABLE --- */
        .table-container {
            overflow-x: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }
        th, td {
            text-align: left;
            padding: 0.75rem 0.5rem;
            border-bottom: 1px solid #e2e8f0;
        }
        th {
            font-weight: 600;
            color: var(--text-secondary);
            background-color: #f8fafc;
        }
        .profit-high { color: var(--accent-green); font-weight: bold; }
        .profit-mid { color: var(--accent-yellow); font-weight: bold; }
        .profit-low { color: var(--accent-red); font-weight: bold; }

        /* --- SIMULATIONS --- */
        .simulation-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        .sim-card {
            background: #f1f5f9;
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }
        .sim-title { font-weight: bold; font-size: 0.9rem; margin-bottom: 0.5rem; }
        .sim-impact { color: var(--accent-green); font-weight: 800; font-size: 1.1rem; }

        /* --- RECOMMENDATIONS --- */
        .rec-list {
            list-style: none;
        }
        .rec-list li {
            margin-bottom: 0.75rem;
            padding-left: 1.5rem;
            position: relative;
        }
        .rec-list li::before {
            content: "‚Üí";
            position: absolute;
            left: 0;
            color: var(--accent-blue);
            font-weight: bold;
        }

    </style>
</head>
<body>

    <!-- TELA DE LOGIN -->
    <div id="login-screen">
        <div class="login-card">
            <div class="login-logo">Cl√≠nica FACES</div>
            <div class="login-subtitle">Acesso Restrito ao Relat√≥rio Executivo</div>
            
            <input type="password" id="passwordInput" class="login-input" placeholder="DIGITE A SENHA DE ACESSO">
            <button class="login-btn" onclick="checkPassword()">Acessar Painel</button>
            <div id="loginError" class="error-msg">SENHA INCORRETA</div>
        </div>
    </div>

    <!-- CONTE√öDO DO DASHBOARD (Oculto inicialmente) -->
    <div id="dashboard-content">
        <!-- 1Ô∏è‚É£ CAPA EXECUTIVA -->
        <header>
            <div class="header-content">
                <h1>Relat√≥rio Financeiro Estrat√©gico</h1>
                <div class="subtitle">Cl√≠nica FACES ‚Äî An√°lise de Rentabilidade & Capacidade</div>
            </div>
            <div class="agency-badge">
                AGENCY<br>OF<br>THE<br>YEAR.<br><span style="font-weight:400; font-size:0.5rem; opacity:0.8;">Design Systems</span>
            </div>
        </header>

        <div class="container">

            <!-- 2Ô∏è‚É£ VIS√ÉO GERAL FINANCEIRA (KPIs) -->
            <div class="card col-3">
                <div class="card-title">Faturamento Total</div>
                <div class="kpi-value">R$ <span id="kpi-revenue"></span></div>
                <div class="kpi-sub">Receita bruta mensal</div>
            </div>
            <div class="card col-3">
                <div class="card-title">Lucro Total</div>
                <div class="kpi-value text-green">R$ <span id="kpi-profit"></span></div>
                <div class="kpi-sub">L√≠quido ap√≥s despesas</div>
            </div>
            <div class="card col-3">
                <div class="card-title">Margem L√≠quida</div>
                <div class="kpi-value text-green"><span id="kpi-margin"></span>%</div>
                <div class="kpi-sub">Sa√∫de financeira: Saud√°vel</div>
            </div>
            <div class="card col-3">
                <div class="card-title">Custo Total</div>
                <div class="kpi-value text-red">R$ <span id="kpi-cost"></span></div>
                <div class="kpi-sub">Operacional + Vari√°vel</div>
            </div>

            <!-- 3Ô∏è‚É£ AN√ÅLISE DE CUSTOS & PIZZA -->
            <div class="card col-4">
                <div class="card-title">Distribui√ß√£o do Faturamento</div>
                <canvas id="costsPieChart"></canvas>
                <div class="insight-box">
                    "Note que a fatia das Comiss√µes (30%) √© maior que o pr√≥prio Lucro da cl√≠nica (25%)."
                </div>
            </div>

            <div class="card col-8">
                <div class="card-title">Destino do Faturamento (Perspectiva de Lucro)</div>
                <canvas id="stackedBarChart" height="120"></canvas>
                <div style="margin-top: 15px; font-size: 0.9rem; color: #475569;">
                    <strong>Perspectiva Real:</strong> Observe a barra verde em rela√ß√£o ao todo. Para cada R$ 100,00 que entram na cl√≠nica, <strong>apenas R$ 25,00 permanecem como lucro real</strong>. O maior volume de sa√≠da (Laranja) s√£o as comiss√µes, que competem diretamente com a margem da empresa.
                </div>
            </div>

            <!-- 4Ô∏è‚É£ AN√ÅLISE DE PRODUTIVIDADE -->
            <div class="card col-6">
                <div class="card-title">Capacidade vs. Ociosidade</div>
                <div style="display: flex; align-items: center; justify-content: space-around;">
                    <div style="width: 180px;">
                        <canvas id="productivityChart"></canvas>
                    </div>
                    <div>
                        <div class="alert-badge">ALERTA DE EFICI√äNCIA</div>
                        <div style="font-size: 2rem; font-weight: 800; color: var(--text-primary);">62%</div>
                        <div style="font-size: 0.9rem; color: var(--text-secondary);">da agenda dispon√≠vel n√£o foi utilizada.</div>
                        <br>
                        <div><strong>Horas Totais:</strong> <span id="hours-total"></span>h</div>
                        <div><strong>Horas Ociosas:</strong> <span id="hours-idle"></span>h</div>
                    </div>
                </div>
                <div class="insight-box">
                    "A cl√≠nica n√£o tem um problema grave de custos, mas um enorme potencial desperdi√ßado de agenda. O custo fixo est√° sendo dilu√≠do em poucas horas."
                </div>
            </div>

            <!-- 6Ô∏è‚É£ MATRIZ TEMPO √ó LUCRO -->
            <div class="card col-6">
                <div class="card-title">Matriz de Ouro: Tempo vs. Lucro</div>
                <canvas id="scatterChart"></canvas>
                <div class="insight-box">
                    <strong>Quadrante Superior Esquerdo:</strong> Procedimentos r√°pidos e lucrativos (Facetas, Limpezas).
                    <br><strong>Quadrante Inferior Direito:</strong> Procedimentos longos e de menor margem.
                </div>
            </div>

            <!-- 5Ô∏è‚É£ AN√ÅLISE POR PROCEDIMENTO (TABELA) -->
            <div class="card col-12">
                <div class="card-title">Rentabilidade por Procedimento (Top Performance)</div>
                <div class="table-container">
                    <table id="proceduresTable">
                        <thead>
                            <tr>
                                <th>Procedimento</th>
                                <th>Qtd</th>
                                <th>Receita Total</th>
                                <th>Custo Total</th>
                                <th>Tempo Total</th>
                                <th>Lucro L√≠quido</th>
                                <th>Margem</th>
                                <th>Classifica√ß√£o</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Preenchido via JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- 7Ô∏è‚É£ SIMULA√á√ïES -->
            <div class="card col-12">
                <div class="card-title">Simula√ß√µes de Cen√°rio (What If)</div>
                <div class="simulation-grid">
                    <div class="sim-card">
                        <div class="sim-title">Cen√°rio A: +3 Facetas/m√™s</div>
                        <div class="sim-impact">+ R$ 1.650,00 Lucro</div>
                        <p style="font-size: 0.8rem; color: #64748b;">Utilizando apenas 1h 45min da ociosidade atual.</p>
                    </div>
                    <div class="sim-card">
                        <div class="sim-title">Cen√°rio B: Ocupar 50% da Ociosidade</div>
                        <div class="sim-impact">+ R$ 6.200,00 Lucro</div>
                        <p style="font-size: 0.8rem; color: #64748b;">Considerando mix atual de servi√ßos. Margem subiria para 32%.</p>
                    </div>
                    <div class="sim-card">
                        <div class="sim-title">Cen√°rio C: Redu√ß√£o Taxa Cart√£o (2%)</div>
                        <div class="sim-impact">+ R$ 450,00/m√™s</div>
                        <p style="font-size: 0.8rem; color: #64748b;">Ajuste financeiro simples sem esfor√ßo cl√≠nico.</p>
                    </div>
                </div>
            </div>

            <!-- 8Ô∏è‚É£ & 9Ô∏è‚É£ DIAGN√ìSTICO E RECOMENDA√á√ïES -->
            <div class="card col-6">
                <div class="card-title">Diagn√≥stico Final</div>
                <ul class="rec-list">
                    <li><strong>Depend√™ncia de Comiss√µes:</strong> Modelo de repasse (30%) √© alto. Em procedimentos de baixo valor agregado, o lucro da cl√≠nica fica comprimido.</li>
                    <li><strong>Ociosidade Cr√≠tica:</strong> Com 108 horas livres, a cl√≠nica est√° pagando aluguel e custos fixos para manter a sala vazia na maior parte do tempo.</li>
                    <li><strong>Mix de Produtos:</strong> Facetas e Limpezas sustentam a rentabilidade. Procedimentos longos como Clareamento de Consult√≥rio (3h) entregam margem menor por hora.</li>
                </ul>
            </div>
            <div class="card col-6" style="background-color: #f0fdf4; border: 1px solid #bbf7d0;">
                <div class="card-title" style="color: #166534;">Recomenda√ß√µes Estrat√©gicas</div>
                <ul class="rec-list" style="color: #14532d;">
                    <li><strong>Curto Prazo (30 dias):</strong> Campanha focada em preencher "buracos" na agenda com Limpezas (procedimento √¢ncora de alta margem/hora).</li>
                    <li><strong>M√©dio Prazo:</strong> Revisar precifica√ß√£o de procedimentos que levam mais de 2 horas.</li>
                    <li><strong>Estrutural:</strong> Negociar taxa escalonada de comiss√£o (ex: 25% base + 5% b√¥nus por meta) para proteger a margem da cl√≠nica.</li>
                </ul>
            </div>

        </div>
    </div>

    <script>
        // --- AUTH LOGIC ---
        const passwordInput = document.getElementById('passwordInput');
        passwordInput.addEventListener("keypress", function(event) {
            if (event.key === "Enter") {
                checkPassword();
            }
        });

        function checkPassword() {
            const pass = document.getElementById('passwordInput').value;
            const errorMsg = document.getElementById('loginError');
            const loginScreen = document.getElementById('login-screen');
            const dashboard = document.getElementById('dashboard-content');

            if (pass === "OPENYOURMIND") {
                // Sucesso
                loginScreen.style.opacity = "0";
                
                setTimeout(() => {
                    loginScreen.style.display = "none";
                    dashboard.style.display = "block";
                    // Pequeno delay para garantir que o display block foi processado antes de inicializar gr√°ficos
                    // isso ajuda o Chart.js a calcular o tamanho correto
                    setTimeout(() => {
                        dashboard.style.opacity = "1";
                        initDashboard(); 
                    }, 50);
                }, 500);

            } else {
                // Erro
                errorMsg.style.opacity = "1";
                document.getElementById('passwordInput').style.borderColor = "var(--accent-red)";
                
                // Shake effect (opcional, simples visual cue)
                passwordInput.classList.add('shake');
                setTimeout(() => passwordInput.classList.remove('shake'), 500);
            }
        }

        // --- DADOS ATUALIZADOS (Baseados na solicita√ß√£o) ---
        const summaryData = {
            revenue: 30910,      // Faturamento Total
            fixedExpenses: 5393, // Despesas Fixas (Arredondado UP de 5392.77)
            materials: 4041,     // Materiais (Arredondado DOWN de 4041.46)
            commissions: 9403,   // Comiss√µes
            taxes: 2472,         // Impostos (Arredondado DOWN de 2472.80)
            cardFees: 1828,      // Taxas Cart√£o (Arredondado DOWN de 1828.40)
            totalProfit: 7771,   // Lucro Total (Solicitado)
            totalCost: 23138,    // Custo Total (Solicitado)
            
            // Gest√£o de Tempo
            totalHours: 176,
            usedHours: 67.17,
            idleHours: 108.83
        };

        // Dados por Procedimento
        const proceduresData = [
            { name: "Clareamento Caseiro", qty: 2, price: 780, totalRevenue: 1560, totalCost: 1092, timeMin: 120, totalTimeH: 4, profit: 468 },
            { name: "Clareamento Consult√≥rio", qty: 2, price: 1000, totalRevenue: 2000, totalCost: 1400, timeMin: 180, totalTimeH: 6, profit: 600 },
            { name: "Endodontia", qty: 2, price: 650, totalRevenue: 1300, totalCost: 910, timeMin: 90, totalTimeH: 3, profit: 390 },
            { name: "Facetas", qty: 20, price: 550, totalRevenue: 11000, totalCost: 6501, timeMin: 35, totalTimeH: 11.67, profit: 4499 },
            { name: "Limpeza", qty: 20, price: 280, totalRevenue: 5600, totalCost: 3108, timeMin: 30, totalTimeH: 10, profit: 2492 },
            { name: "Manut. Orto Conv.", qty: 15, price: 110, totalRevenue: 1650, totalCost: 862, timeMin: 30, totalTimeH: 7.5, profit: 788 },
            { name: "Rest. Grande", qty: 15, price: 280, totalRevenue: 4200, totalCost: 2185, timeMin: 60, totalTimeH: 15, profit: 2015 },
            { name: "Rest. Pequena", qty: 20, price: 180, totalRevenue: 3600, totalCost: 2350, timeMin: 30, totalTimeH: 10, profit: 1250 }
        ];

        // --- FUN√á√ÉO DE INICIALIZA√á√ÉO DOS GR√ÅFICOS (CHAMADA S√ì AP√ìS LOGIN) ---
        function initDashboard() {
            
            // --- POPULATE TEXT FIELDS ---
            document.getElementById('kpi-revenue').textContent = summaryData.revenue.toLocaleString('pt-BR');
            document.getElementById('kpi-profit').textContent = summaryData.totalProfit.toLocaleString('pt-BR');
            
            // Calcular margem
            document.getElementById('kpi-margin').textContent = "25,14"; 

            document.getElementById('kpi-cost').textContent = summaryData.totalCost.toLocaleString('pt-BR');
            
            document.getElementById('hours-total').textContent = summaryData.totalHours;
            document.getElementById('hours-idle').textContent = summaryData.idleHours.toLocaleString('pt-BR');


            // --- CHART CONFIGURATION ---
            Chart.defaults.font.family = "'Inter', sans-serif";
            Chart.defaults.color = '#64748b';

            // 1. Costs Pie Chart
            const ctxPie = document.getElementById('costsPieChart').getContext('2d');
            new Chart(ctxPie, {
                type: 'doughnut',
                data: {
                    labels: ['Lucro L√≠quido', 'Comiss√µes', 'Despesas Fixas', 'Materiais', 'Impostos', 'Taxas Cart√£o'],
                    datasets: [{
                        data: [
                            summaryData.totalProfit, 
                            summaryData.commissions, 
                            summaryData.fixedExpenses, 
                            summaryData.materials, 
                            summaryData.taxes, 
                            summaryData.cardFees
                        ],
                        backgroundColor: [
                            '#10b981', // Lucro (Verde)
                            '#f59e0b', // Comiss√µes (Laranja)
                            '#64748b', // Fixos (Cinza)
                            '#3b82f6', // Materiais (Azul)
                            '#ef4444', // Impostos (Vermelho)
                            '#ef4444'  // Taxas (Vermelho)
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'right', labels: { boxWidth: 12, font: { size: 10 } } }
                    }
                }
            });

            // 2. Stacked Bar Chart
            const ctxBar = document.getElementById('stackedBarChart').getContext('2d');
            new Chart(ctxBar, {
                type: 'bar',
                data: {
                    labels: ['Faturamento (100%)'],
                    datasets: [
                        { label: 'Lucro L√≠quido', data: [summaryData.totalProfit], backgroundColor: '#10b981' }, // Verde
                        { label: 'Comiss√µes', data: [summaryData.commissions], backgroundColor: '#f59e0b' }, // Laranja
                        { label: 'Fixos', data: [summaryData.fixedExpenses], backgroundColor: '#64748b' }, // Cinza
                        { label: 'Materiais', data: [summaryData.materials], backgroundColor: '#3b82f6' }, // Azul
                        { label: 'Impostos/Taxas', data: [summaryData.taxes + summaryData.cardFees], backgroundColor: '#ef4444' } // Vermelho
                    ]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    scales: { x: { stacked: true, grid: { display: false } }, y: { stacked: true, display: false } },
                    plugins: { legend: { position: 'bottom' } }
                }
            });

            // 3. Productivity Chart (Donut)
            const ctxProd = document.getElementById('productivityChart').getContext('2d');
            new Chart(ctxProd, {
                type: 'doughnut',
                data: {
                    labels: ['Ocioso', 'Produtivo'],
                    datasets: [{
                        data: [summaryData.idleHours, summaryData.usedHours],
                        backgroundColor: ['#e2e8f0', '#0f172a'],
                        hoverOffset: 4
                    }]
                },
                options: {
                    cutout: '70%',
                    plugins: { legend: { display: false } }
                }
            });

            // 4. Scatter Plot (Time x Profit)
            const ctxScatter = document.getElementById('scatterChart').getContext('2d');
            const scatterData = proceduresData.map(proc => ({
                x: proc.timeMin, // Tempo em minutos (Eixo X)
                y: proc.profit / proc.qty, // Lucro unit√°rio (Eixo Y)
                procedure: proc.name
            }));

            new Chart(ctxScatter, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Procedimentos',
                        data: scatterData,
                        backgroundColor: 'rgba(16, 185, 129, 0.6)',
                        borderColor: '#10b981',
                        pointRadius: 6,
                        pointHoverRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: { title: { display: true, text: 'Tempo Gasto (minutos)' } },
                        y: { title: { display: true, text: 'Lucro Unit√°rio (R$)' } }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let point = context.raw;
                                    return point.procedure + ': R$ ' + point.y.toFixed(2) + ' (' + point.x + ' min)';
                                }
                            }
                        }
                    }
                }
            });

            // 5. Populate Table
            const tableBody = document.querySelector('#proceduresTable tbody');
            // Limpa tabela antes de popular para evitar duplicados se init for chamado mais de uma vez (embora n√£o seja aqui)
            tableBody.innerHTML = ''; 
            
            proceduresData.sort((a, b) => b.profit - a.profit).forEach(proc => {
                const margin = (proc.profit / proc.totalRevenue) * 100;
                let classification = "";
                let classColor = "";

                if (margin > 30) { classification = "üü¢ Alta Rentabilidade"; classColor = "profit-high"; }
                else if (margin > 20) { classification = "üü° Moderado"; classColor = "profit-mid"; }
                else { classification = "üî¥ Baixa/Risco"; classColor = "profit-low"; }

                const row = `
                    <tr>
                        <td>${proc.name}</td>
                        <td>${proc.qty}</td>
                        <td>R$ ${proc.totalRevenue.toLocaleString('pt-BR')}</td>
                        <td>R$ ${proc.totalCost.toLocaleString('pt-BR')}</td>
                        <td>${proc.totalTimeH.toFixed(1)} h</td>
                        <td class="${classColor}">R$ ${proc.profit.toLocaleString('pt-BR')}</td>
                        <td>${margin.toFixed(1)}%</td>
                        <td>${classification}</td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            });
        }
    </script>
</body>
</html>
